<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chemistry Reaction Explorer | Interactive Tools</title>
  <style>
    /* Previous styles remain, adding new ones for tools */
    .tool-container {
      margin: 30px 0;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .tool-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid #ddd;
    }
    .tool-tab {
      padding: 10px 20px;
      cursor: pointer;
      background: #eee;
      margin-right: 5px;
      border-radius: 5px 5px 0 0;
    }
    .tool-tab.active {
      background: #007acc;
      color: white;
    }
    .tool-content {
      display: none;
    }
    .tool-content.active {
      display: block;
    }
    .molecule-canvas {
      width: 100%;
      height: 300px;
      background: white;
      border: 1px solid #ddd;
      margin: 15px 0;
    }
    .simulator-area {
      min-height: 200px;
      border: 2px dashed #007acc;
      padding: 20px;
      margin: 15px 0;
      text-align: center;
    }
    .element-draggable {
      display: inline-block;
      padding: 10px;
      margin: 5px;
      background: #007acc;
      color: white;
      border-radius: 5px;
      cursor: grab;
    }
    .reaction-visualization {
      margin: 20px auto;
      text-align: center;
    }
    .calculation-result {
      font-weight: bold;
      color: #007acc;
      margin: 15px 0;
      padding: 10px;
      background: #f0f8ff;
      border-left: 4px solid #007acc;
    }
  </style>
  <!-- Include 3D molecule viewer library -->
  <script src="https://3Dmol.csb.pitt.edu/build/3Dmol-min.js"></script>
  <!-- Include MathJax for chemical equations -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://3Dmol.org/build/3Dmol-min.js"></script>     
  <script src="https://3Dmol.org/build/3Dmol.ui-min.js"></script>   
</head>
<body>

<!-- Previous header and ad containers remain -->

<div class="container">
  <div class="tool-container">
    <h2>Chemistry Tools</h2>
    
    <div class="tool-tabs">
      <div class="tool-tab active" onclick="openTool('balancer')">Equation Balancer</div>
      <div class="tool-tab" onclick="openTool('simulator')">Reaction Simulator</div>
      <div class="tool-tab" onclick="openTool('stoichiometry')">Stoichiometry Calculator</div>
      <div class="tool-tab" onclick="openTool('redox')">Redox Analyzer</div>
      <div class="tool-tab" onclick="openTool('ph')">pH Calculator</div>
    </div>
    
    <!-- Equation Balancer Tool -->
    <div id="balancer" class="tool-content active">
      <h3>Chemical Equation Balancer</h3>
      <input type="text" id="unbalancedEquation" placeholder="Enter unbalanced equation (e.g., H2 + O2 â†’ H2O)">
      <button onclick="balanceEquation()">Balance Equation</button>
      <div id="balancingSteps" class="calculation-result"></div>
      <div id="balancedEquation" style="font-size: 1.5em; margin: 15px 0;"></div>
      <div id="moleculeViewer" class="molecule-canvas"></div>
    </div>
    
    <!-- Reaction Simulator -->
    <div id="simulator" class="tool-content">
      <h3>Reaction Simulator</h3>
      <p>Drag elements/compounds into the reaction area:</p>
      <div>
        <span class="element-draggable" draggable="true" data-formula="H2">Hâ‚‚</span>
        <span class="element-draggable" draggable="true" data-formula="O2">Oâ‚‚</span>
        <span class="element-draggable" draggable="true" data-formula="Na">Na</span>
        <span class="element-draggable" draggable="true" data-formula="Cl2">Clâ‚‚</span>
        <span class="element-draggable" draggable="true" data-formula="CH4">CHâ‚„</span>
        <span class="element-draggable" draggable="true" data-formula="H2O">Hâ‚‚O</span>
      </div>
      <div class="simulator-area" id="reactionArea" ondrop="drop(event)" ondragover="allowDrop(event)">
        <p>Drop reactants here</p>
      </div>
      <button onclick="simulateReaction()">Simulate Reaction</button>
      <div id="reactionResult"></div>
      <div class="reaction-visualization" id="reactionVisualization"></div>
    </div>
    
    <!-- Stoichiometry Calculator -->
    <div id="stoichiometry" class="tool-content">
      <h3>Stoichiometry Calculator</h3>
      <input type="text" id="stoichEquation" placeholder="Balanced equation (e.g., 2H2 + O2 â†’ 2H2O)">
      <input type="text" id="givenCompound" placeholder="Compound (e.g., H2)">
      <input type="number" id="givenAmount" placeholder="Amount (e.g., 10)">
      <select id="amountUnit">
        <option value="g">grams</option>
        <option value="mol">moles</option>
      </select>
      <input type="text" id="targetCompound" placeholder="Find amount for (e.g., H2O)">
      <button onclick="calculateStoichiometry()">Calculate</button>
      <div id="stoichResult" class="calculation-result"></div>
    </div>
    
    <!-- Redox Analyzer -->
    <div id="redox" class="tool-content">
      <h3>Redox Reaction Analyzer</h3>
      <input type="text" id="redoxEquation" placeholder="Enter redox reaction (e.g., Zn + CuSO4 â†’ ZnSO4 + Cu)">
      <button onclick="analyzeRedox()">Analyze</button>
      <div id="oxidationNumbers"></div>
      <div id="halfReactions"></div>
      <div id="redoxVisualization"></div>
    </div>
    
    <!-- pH Calculator -->
    <div id="ph" class="tool-content">
      <h3>pH Calculator & Titration Simulator</h3>
      <select id="phToolType" onchange="changePhTool()">
        <option value="calculator">pH Calculator</option>
        <option value="titration">Titration Simulator</option>
      </select>
      
      <div id="phCalculator">
        <select id="phSubstanceType">
          <option value="strongAcid">Strong Acid</option>
          <option value="weakAcid">Weak Acid</option>
          <option value="strongBase">Strong Base</option>
          <option value="weakBase">Weak Base</option>
        </select>
        <input type="number" id="phConcentration" placeholder="Concentration (M)" step="0.001">
        <input type="number" id="phKaKb" placeholder="Ka/Kb value (for weak acids/bases)" step="1e-5" style="display:none;">
        <button onclick="calculatePH()">Calculate pH</button>
        <div id="phResult" class="calculation-result"></div>
      </div>
      
      <div id="titrationSimulator" style="display:none;">
        <div>
          <label>Acid Volume (mL):</label>
          <input type="range" id="acidVolume" min="0" max="100" value="50">
          <span id="acidVolumeValue">50</span> mL
        </div>
        <div>
          <label>Base Volume (mL):</label>
          <input type="range" id="baseVolume" min="0" max="100" value="0">
          <span id="baseVolumeValue">0</span> mL
        </div>
        <canvas id="titrationCurve" width="400" height="300" style="border:1px solid #ddd;"></canvas>
        <div style="height: 400px; width: 400px; position: relative;" class='viewer_3Dmoljs' data-pdb='2POR' data-backgroundcolor='0xffffff' data-style='stick' data-ui='true'></div>       
      </div>
    </div>
  </div>
  
  <!-- Previous reaction list and blog sections remain -->
</div>

<script>
  // Equation Balancer
  function balanceEquation() {
    const input = document.getElementById('unbalancedEquation').value;
    if (!input) return;
    
    // In a real app, you'd call a chemistry API or use a library
    // This is a simplified example
    const examples = {
      "H2 + O2 â†’ H2O": {
        balanced: "2Hâ‚‚ + Oâ‚‚ â†’ 2Hâ‚‚O",
        steps: [
          "Count atoms on each side: H=2, O=2 â†’ H=2, O=1",
          "Balance oxygen by adding coefficient to Hâ‚‚O",
          "Now hydrogen is unbalanced (4 on left, 2 on right)",
          "Add coefficient to Hâ‚‚ on left to balance hydrogen"
        ]
      },
      "CH4 + O2 â†’ CO2 + H2O": {
        balanced: "CHâ‚„ + 2Oâ‚‚ â†’ COâ‚‚ + 2Hâ‚‚O",
        steps: [
          "Balance carbon first (already balanced)",
          "Balance hydrogen by adding coefficient to Hâ‚‚O",
          "Finally balance oxygen"
        ]
      }
    };
    
    let result = examples[input];
    if (!result) {
      result = {
        balanced: "Could not balance automatically. Try common examples like H2 + O2 â†’ H2O",
        steps: ["No balancing steps available for this equation"]
      };
    }
    
    document.getElementById('balancedEquation').innerHTML = `Balanced: <strong>${result.balanced}</strong>`;
    document.getElementById('balancingSteps').innerHTML = 
      "<h4>Balancing Steps:</h4><ol>" + 
      result.steps.map(step => `<li>${step}</li>`).join('') + 
      "</ol>";
    
    // Visualize molecules (simplified - would use 3DMol.js in real implementation)
    visualizeMolecules(result.balanced);
  }
  
  // Reaction Simulator
  function allowDrop(e) {
    e.preventDefault();
  }
  
  function drag(e) {
    e.dataTransfer.setData("text", e.target.dataset.formula);
  }
  
  function drop(e) {
    e.preventDefault();
    const formula = e.dataTransfer.getData("text");
    const newElement = document.createElement('span');
    newElement.className = 'element-draggable';
    newElement.textContent = formula.replace(/\d/g, d => 'â‚€â‚â‚‚â‚ƒâ‚„â‚…â‚†â‚‡â‚ˆâ‚‰'[d]);
    newElement.dataset.formula = formula;
    e.target.appendChild(newElement);
  }
  
  function simulateReaction() {
    const area = document.getElementById('reactionArea');
    const formulas = Array.from(area.children)
      .filter(el => el.dataset.formula)
      .map(el => el.dataset.formula);
    
    if (formulas.length < 2) {
      alert("Please add at least 2 reactants");
      return;
    }
    
    // Simple reaction examples
    const reactions = {
      "H2,O2": {
        equation: "2Hâ‚‚ + Oâ‚‚ â†’ 2Hâ‚‚O",
        type: "Combustion",
        visualization: "<div style='color:red;font-size:2em'>ðŸ”¥</div>Combustion reaction producing water"
      },
      "Na,Cl2": {
        equation: "2Na + Clâ‚‚ â†’ 2NaCl",
        type: "Synthesis",
        visualization: "<div style='color:white;background:yellow;padding:10px;'>Sodium chloride (salt) formation</div>"
      },
      "CH4,O2": {
        equation: "CHâ‚„ + 2Oâ‚‚ â†’ COâ‚‚ + 2Hâ‚‚O",
        type: "Combustion",
        visualization: "<div style='color:orange;font-size:2em'>ðŸ”¥</div>Methane combustion"
      }
    };
    
    const key = formulas.sort().join(',');
    const result = reactions[key] || {
      equation: "No known reaction between these substances",
      type: "Unknown",
      visualization: ""
    };
    
    document.getElementById('reactionResult').innerHTML = `
      <h4>Reaction:</h4>
      <p>${result.equation}</p>
      <p><strong>Type:</strong> ${result.type}</p>
    `;
    document.getElementById('reactionVisualization').innerHTML = result.visualization;
  }
  
  // Stoichiometry Calculator
  function calculateStoichiometry() {
    const equation = document.getElementById('stoichEquation').value;
    const given = document.getElementById('givenCompound').value;
    const amount = parseFloat(document.getElementById('givenAmount').value);
    const unit = document.getElementById('amountUnit').value;
    const target = document.getElementById('targetCompound').value;
    
    if (!equation || !given || !amount || !target) {
      alert("Please fill all fields");
      return;
    }
    
    // Simplified calculation - real implementation would parse equation hv to change 
    const examples = {
      "2H2 + O2 â†’ 2H2O": {
        H2: { molarMass: 2.016, coeff: 2 },
        O2: { molarMass: 32.00, coeff: 1 },
        H2O: { molarMass: 18.015, coeff: 2 }
      }
    };
    
    const data = examples[equation];
    if (!data || !data[given] || !data[target]) {
      document.getElementById('stoichResult').innerHTML = 
        "Could not calculate. Try example: 2H2 + O2 â†’ 2H2O with H2=10g to H2O";
      return;
    }
    
    let moles;
    if (unit === 'g') {
      moles = amount / data[given].molarMass;
    } else {
      moles = amount;
    }
    
    const targetMoles = moles * (data[target].coeff / data[given].coeff);
    const targetGrams = targetMoles * data[target].molarMass;
    
    document.getElementById('stoichResult').innerHTML = `
      <h4>Result:</h4>
      <p>${amount} ${unit} of ${given} produces:</p>
      <p>${targetMoles.toFixed(4)} moles of ${target}</p>
      <p>${targetGrams.toFixed(4)} grams of ${target}</p>
    `;
  }
  
  // pH Calculator
  function calculatePH() {
    const type = document.getElementById('phSubstanceType').value;
    const conc = parseFloat(document.getElementById('phConcentration').value);
    const kaKb = parseFloat(document.getElementById('phKaKb').value);
    
    if (!conc || (type.includes('weak') && !kaKb)) {
      alert("Please fill all required fields");
      return;
    }
    
    let ph;
    if (type === 'strongAcid') {
      ph = -Math.log10(conc);
    } else if (type === 'strongBase') {
      ph = 14 + Math.log10(conc);
    } else if (type === 'weakAcid') {
      const h = Math.sqrt(kaKb * conc);
      ph = -Math.log10(h);
    } else if (type === 'weakBase') {
      const oh = Math.sqrt(kaKb * conc);
      ph = 14 + Math.log10(oh);
    }
    
    document.getElementById('phResult').innerHTML = `
      <h4>Result:</h4>
      <p>Calculated pH: ${ph.toFixed(2)}</p>
      <p>Solution is ${ph < 7 ? 'acidic' : ph > 7 ? 'basic' : 'neutral'}</p>
    `;
  }
  
  // Tool navigation
  function openTool(toolName) {
    document.querySelectorAll('.tool-content').forEach(el => {
      el.classList.remove('active');
    });
    document.querySelectorAll('.tool-tab').forEach(el => {
      el.classList.remove('active');
    });
    
    document.getElementById(toolName).classList.add('active');
    document.querySelector(`.tool-tab[onclick="openTool('${toolName}')"]`).classList.add('active');
  }
  
  function changePhTool() {
    const type = document.getElementById('phToolType').value;
    document.getElementById('phCalculator').style.display = 
      type === 'calculator' ? 'block' : 'none';
    document.getElementById('titrationSimulator').style.display = 
      type === 'titration' ? 'block' : 'none';
  }
  
  // Initialize
  document.addEventListener('DOMContentLoaded', function() {
    // Set up drag events for simulator
    document.querySelectorAll('.element-draggable').forEach(el => {
      el.addEventListener('dragstart', drag);
    });
    
    // Show Ka/Kb field only for weak acids/bases
    document.getElementById('phSubstanceType').addEventListener('change', function() {
      document.getElementById('phKaKb').style.display = 
        this.value.includes('weak') ? 'block' : 'none';
    });
    
    // Initialize titration curve
    const canvas = document.getElementById('titrationCurve');
    const ctx = canvas.getContext('2d');
    // Draw axes
    ctx.beginPath();
    ctx.moveTo(50, 50);
    ctx.lineTo(50, 250);
    ctx.lineTo(350, 250);
    ctx.stroke();
    ctx.fillText("pH", 30, 30);
    ctx.fillText("Volume added (mL)", 300, 270);
  });
</script>

</body>
</html>
